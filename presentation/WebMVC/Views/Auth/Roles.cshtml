<div class="content-wrapper">
    <section class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1>@ViewData["Title"]</h1>
                </div>
            </div>
        </div>
    </section>

    <section class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">List of Roles</h3>
                        </div>

                        <div class="card-body">
                            <div id="rolesGrid" style="overflow: visible"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

@section Styles{
}

@section Scripts{
    <script>
        $("#rolesGrid").jsGrid({
            height: "500px",
            width: "100%",

            filtering: true,
            sorting: true,
            paging: false,
            inserting: true,
            editing: true,
            autoload: true,

            onItemUpdating: function (args) {
                previousItem = args.previousItem;
            },

            controller: {
                loadData: function (filter) {
                    var d = $.Deferred();

                    if (filter.rowStatus == true) {
                        filter.rowStatus = 1;
                    }
                    else if (filter.rowStatus == false) {
                        filter.rowStatus = 0;
                    }

                    $.ajax({
                        type: "GET",
                        url: "../Auth/GetRoles",
                        data: filter,
                        dataType: "json"
                    }).done(function (response) {
                        d.resolve(response.data);
                    });

                    return d.promise();
                },
                insertItem: function (item) {
                    var d = $.Deferred();

                    $.ajax({
                        type: "POST",
                        url: "../Auth/AddRole",
                        data: item,
                        dataType: "json"
                    }).done(function (response) {
                        d.resolve(response.data);
                        $(function () { Swal.fire({ icon: 'success', title: 'Success!', text: 'Role created successfully.' }) });
                    }).fail(function (response) {
                        $(function () { Swal.fire({ icon: 'error', title: 'Error!', text: response.data.message }) });
                    });

                    return d.promise();
                },
                updateItem: function (item) {
                    var d = $.Deferred();

                    if (item.rowStatus == true) {
                        item.rowStatus = 1;
                    }
                    else if (item.rowStatus == false) {
                        item.rowStatus = 0;
                    }

                    $.ajax({
                        type: "PUT",
                        url: "../Auth/UpdateRole/" + item.id,
                        data: item,
                        dataType: "json"
                    }).done(function (response) {
                        d.resolve(response.data);
                        $(function () { Swal.fire({ icon: 'success', title: 'Success!', text: 'Role updated successfully.' }) });
                    }).fail(function (response) {
                        d.resolve(previousItem);
                        $(function () { Swal.fire({ icon: 'error', title: 'Error!', text: response.data.message }) });
                    });

                    return d.promise();
                }
            },

            fields: [
                { title: "ID", name: "id", type: "number", width: 50, align: "center", editing: false, inserting: false },
                { title: "Name", name: "name", type: "text", validate: "required" },
                { title: "Status", name: "rowStatus", type: "checkbox", width: 50, inserting: false },
                {
                    title: "Action", align: "center", width: 50,
                    itemTemplate: function (value, item) {
                        var $link = $("<a>").attr("href", "../Auth/MenuRoles/" + item.id).text("Menus");
                        return $("<div>").append($link);
                    }
                },
                { type: "control", width: 200, align: "center", editButton: true, deleteButton: false }
            ]
        });
    </script>
}